<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Real Agents Loading</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .agent {
        border: 1px solid #ccc;
        margin: 10px 0;
        padding: 15px;
        border-radius: 8px;
        background: #f9f9f9;
      }
      .error {
        color: red;
      }
      .success {
        color: green;
      }
      .loading {
        color: blue;
      }
      .wallet-info {
        background: #e8f4ff;
        padding: 10px;
        border-radius: 4px;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h1>üîç AR Viewer - Real Agents Test</h1>
    <div id="status" class="loading">Loading agents...</div>
    <div id="agents"></div>

    <script>
      const SUPABASE_URL = "https://ncjbwzibnqrbrvicdmec.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5jamJ3emlibnFyYnJ2aWNkbWVjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE0NzMzMDAsImV4cCI6MjA3NzA0OTMwMH0.OBxPLTZYpm6J59HFcn6VvXHlDt3r_HXMQEFCYKNR110";

      const supabase = window.supabase.createClient(
        SUPABASE_URL,
        SUPABASE_ANON_KEY
      );

      async function loadRealAgents() {
        try {
          console.log("üîç Testing direct Supabase connection...");

          // Test 1: Basic connection
          const { data: connectionTest, error: connectionError } =
            await supabase.from("deployed_objects").select("count").limit(1);

          if (connectionError) {
            throw new Error(`Connection failed: ${connectionError.message}`);
          }

          console.log("‚úÖ Supabase connection successful");

          // Test 2: Get all agents with enhanced fields
          const { data: agents, error: agentsError } = await supabase
            .from("deployed_objects")
            .select(
              `
                        id, name, description, agent_type, location_lat, location_lng,
                        deployer_wallet_address, payment_recipient_address, agent_wallet_address,
                        token_address, token_symbol, interaction_fee,
                        text_chat, voice_chat, video_chat,
                        mcp_services, features, created_at
                    `
            )
            .eq("is_active", true)
            .order("created_at", { ascending: false })
            .limit(20);

          if (agentsError) {
            throw new Error(`Agents query failed: ${agentsError.message}`);
          }

          console.log(`‚úÖ Found ${agents.length} real agents in database`);

          const statusDiv = document.getElementById("status");
          const agentsDiv = document.getElementById("agents");

          statusDiv.innerHTML = `<span class="success">‚úÖ Successfully loaded ${agents.length} real agents from database!</span>`;
          statusDiv.className = "success";

          if (agents.length === 0) {
            agentsDiv.innerHTML = "<p>No active agents found in database.</p>";
            return;
          }

          agentsDiv.innerHTML = agents
            .map(
              (agent) => `
                    <div class="agent">
                        <h3>ü§ñ ${agent.name || "Unnamed Agent"}</h3>
                        <p><strong>Type:</strong> ${
                          agent.agent_type || "Unknown"
                        }</p>
                        <p><strong>Description:</strong> ${
                          agent.description || "No description"
                        }</p>
                        <p><strong>Location:</strong> ${agent.location_lat}, ${
                agent.location_lng
              }</p>
                        
                        <div class="wallet-info">
                            <h4>üí≥ Wallet Information:</h4>
                            <p><strong>Deployer:</strong> ${
                              agent.deployer_wallet_address || "Not set"
                            }</p>
                            <p><strong>Payment Recipient:</strong> ${
                              agent.payment_recipient_address || "Not set"
                            }</p>
                            <p><strong>Agent Wallet:</strong> ${
                              agent.agent_wallet_address || "Not set"
                            }</p>
                            <p><strong>Token:</strong> ${
                              agent.token_symbol || "Not set"
                            } (${agent.token_address || "No address"})</p>
                            <p><strong>Interaction Fee:</strong> ${
                              agent.interaction_fee || 0
                            } ${agent.token_symbol || "tokens"}</p>
                        </div>
                        
                        <p><strong>Communication:</strong> 
                            ${agent.text_chat ? "üí¨" : ""} 
                            ${agent.voice_chat ? "üé§" : ""} 
                            ${agent.video_chat ? "üìπ" : ""}
                        </p>
                        
                        <p><strong>Created:</strong> ${new Date(
                          agent.created_at
                        ).toLocaleString()}</p>
                    </div>
                `
            )
            .join("");
        } catch (error) {
          console.error("‚ùå Error loading agents:", error);
          document.getElementById(
            "status"
          ).innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
          document.getElementById("status").className = "error";
        }
      }

      // Load agents when page loads
      loadRealAgents();
    </script>
  </body>
</html>
